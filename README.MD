# Spotify Playlist Analyzer Telegram Bot

Телеграм-бот, который принимает ссылку на публичный плейлист Spotify, собирает по нему статистику (кол-во треков/альбомов/исполнителей, самые популярные треки/исполнитель/жанр, средняя длительность) и предлагает рекомендации на основе Last.fm.

## Стек

- Python 
- python-telegram-bot
- `aiohttp` (асинхронные запросы)
- `SQLAlchemy` + `aiosqlite` (асинхронный SQLite кэш)
- `python-dotenv` (переменные окружения)

## Как работает

- Принимает ссылку вида (проверяет её валидность): `https://open.spotify.com/playlist/<playlist_id>`
- Проверяет доступность плейлиста (публичный/существует)
- Для каждого трека подтягивает информацию о нём, жанры получаются через артиста через. Всё через Spotify API
- Кэширует:
  - жанры артистов (`artist_genres`)
  - данные треков (`track_cache`)
- Создаёт рекомендации с помощью Last.fm API 
- Формирует ответное сообщение в Telegram:
  - название, автор, описание
  - всего треков, уникальных альбомов, уникальных исполнителей
  - самый популярный трек
  - самый популярный исполнитель и сколько его треков в плейлисте
  - самый популярный жанр
  - средняя длительность трека
  - рекомендации треков



## Структура проекта

- `main.py` — точка входа, инициализация токена Spotify и базы, запуск Telegram polling
- `bot_func.py` — логика Telegram-бота (диалог, ответы, форматирование сообщения)
- `spotify_func.py` — работа со Spotify API (токен, плейлист, треки, жанры артистов)
- `lastfm_func.py` — рекомендации через Last.fm API
- `helpers.py` — утилиты (парсинг playlist id, сбор статистики по плейлисту и т.д.)
- `db.py` — модели SQLAlchemy и функции кэша

## Установка и запуск

Создайте файл `.env` в корне проекта:

```env
BOT_TOKEN=ваш_telegram_bot_token
SPOTIFY_CLIENT_ID=ваш_spotify_client_id
SPOTIFY_CLIENT_SECRET=ваш_spotify_client_secret
LASTFM_API_KEY=ваш_lastfm_api_key
```

```bash
# 1) создать и активировать виртуальное окружение (пример)
python -m venv .venv

# 2) установить зависимости
pip install -r requirements.txt

# 3) запустить
python main.py
```

При первом запуске будет создан файл базы кэша `cache.db`.

## Использование

1. Напишите боту команду `/start` (опционально)
2. Отправьте ссылку на плейлист Spotify, например:
   `https://open.spotify.com/playlist/2AQnDgRlpVRPNBaMZp7S7f?si=6c0f89cd867544c9`

Бот ответит статистикой и рекомендациями.

## Примечания и ограничения

- Поддерживаются только созданные пользователями (т.е. не самим Spotify) **публичные** плейлисты. 
- Локальные треки Spotify (`is_local=true`) пропускаются.
- Рекомендации берутся из Last.fm по похожим трекам для топ-треков плейлиста и фильтруются от уже присутствующих в плейлисте.